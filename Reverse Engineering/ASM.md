

# Registros

| Registro | Descripción                                                        |
| -------- | ------------------------------------------------------------------ |
| ESP      | Apunta al valor superior del stack.                                |
| EIP      | Apunta a la instrucción que esta siendo ejecutada en este momento. |


# Flags

| Flag                               | Descripción                                                                                                                                                                                                                           |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| O o FLAG OVERFLOW (DESBORDAMIENTO) | Se activa cuando al hacer una operación, el resultado cambia de signo dando un valor incorrecto.                                                                                                                                      |
| A o AUXILIAR                       | Tiene una función similar pero para cuando se realizan operaciones con otros formatos que por ahora no nos interesan.                                                                                                                 |
| P o PARIDAD                        | Se activa cuando ejecutamos una instrucción y su resultado es un valor, que pasado a numero binario tiene una cantidad par de unos, como por ejemplo 1010, o 1100 o 1111000 que tienen resultados cuya cantidad de unos total es par. |
| Z o FLAG CERO                      | Se activa cuando ejecutamos una instrucción y el resultado es cero.                                                                                                                                                                   |
| S o FLAG DE SIGNO                  | Se activa cuando el resultado de una operación es negativo, o sea si quiero probarlo cambio EAX a FFFFFFF8 que es -8 decimal                                                                                                          |
| C o CARRY FLAG                     | Se activa cuando se excede el máximo valor posible que se puede mostrar, si ponemos EAX a FFFFFFFF y le sumamos 1 como hicimos las veces anteriores veremos activarse el CARRY FLAG poniéndose a 1.                                   |
| T                                  |                                                                                                                                                                                                                                       |
| D                                  |                                                                                                                                                                                                                                       |
| I                                  |                                                                                                                                                                                                                                       |
# Instrucciones de assembler

| Commando                                      | Descripción                                                                                                                                                                                                                                                   | Ejemplo                                                                                                                                                                  |
| --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| NOP                                           | No operación.                                                                                                                                                                                                                                                 | `NOP`                                                                                                                                                                    |
| PUSH                                          | Agrega un valor al stack.                                                                                                                                                                                                                                     | `PUSH 401008` Agrega el número.<br><br>`PUSH [401008]` Agrega el contenido de una dirección de memoria. (Debemos ir al DUMP a ver que hay allí, será lo que se agregará) |
| POP                                           | Quita la primer el primer valor del stack y lo coloca en la posición que indicamos a continuación del POP.                                                                                                                                                    | `POP EAX`                                                                                                                                                                |
| PUSHAD                                        | Guarda el contenido de los registros en la pila en un orden determinado. Así pues, pushad equivale a: push EAX, ECX, EDX, EBX, ESP, EBP, ESI, EDI.                                                                                                            | `PUSHAD`                                                                                                                                                                 |
| POPAD                                         | Toma los valores del stack y los manda a los registros como si fuera un POP a cada uno. Así popad equivale a: pop EDI, ESI, EBP, ESP, EBX, EDX, ECX, EAX.                                                                                                     | `POPAD`                                                                                                                                                                  |
| MOV                                           | Mueve el segundo operando al primero.                                                                                                                                                                                                                         | `MOV EAX, EBX`                                                                                                                                                           |
| MOVSX (Move with Sign-Extension)              | Copia el contenido del segundo operando, que puede ser un registro o una posición de memoria, en el primero (de doble longitud que el segundo), rellenándose los bits sobrantes por la izquierda con el valor del bit más significativo del segundo operando. | `MOVSX EAX,BX`                                                                                                                                                           |
| MOVZX (Move with Zero-Extend)                 | Igual a movsx, pero en este caso, los espacios sobrantes se rellenan siempre con ceros o sea no depende de si el segundo operando es positivo o no.                                                                                                           | `MOVSX EAX,BX`                                                                                                                                                           |
| LEA (Load Effective Address)                  | Similar a la instrucción mov, pero el primer operando es un registro de uso general y el segundo una dirección de memoria. Esta instrucción es útil sobre todo cuando esta dirección de memoria responde a un cálculo previo.                                 | `LEA EAX,DWORD PTR DS:[ECX+38]`                                                                                                                                          |
| XCHG (Exchange Register/Memory with Register) | Esta instrucción intercambia los contenidos de los dos operandos.                                                                                                                                                                                             | `XCHG EAX,ECX`                                                                                                                                                           |
# Instrucciones  matemáticas

| Commando                        | Descripción                                                                                                                                                                                                                                                                                                                                     | Ejemplo                                   |
| ------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| INC                             | Incrementa el operando                                                                                                                                                                                                                                                                                                                          | `INC EAX`                                 |
| DEC                             | Decrementa el operando                                                                                                                                                                                                                                                                                                                          | `DEC EAX`                                 |
| ADD                             | Add suma ambos operandos y guarda el resultado en el primero.                                                                                                                                                                                                                                                                                   | `ADD EAX,1`                               |
| ADC (ADD WITH CARRY)            | Suman ambos operandos y se le suma el valor del CARRY FLAG O FLAG C y se guarda en el primer operando.                                                                                                                                                                                                                                          | `ADC EDX, 3`                              |
| SUB                             | Resta o substracción o sea la operación contraria a ADD, lo que hace es restar el segundo operando al primero y guardar el resultado en el primer operando.                                                                                                                                                                                     | `SUB EAX,2`                               |
| SBB                             | Operación contraria a ADC, es este caso se restan ambos operandos y se le resta el valor del CARRY FLAG O FLAG C y se guarda en el primer operando.                                                                                                                                                                                             | `SBB EDX,3`                               |
| MUL                             | Multiplica sin considerar los signos de los números que va a multiplicar, y usa un solo operando el otro operando es siempre EAX aunque no se escribe y el resultado lo guarda en EDX:EAX                                                                                                                                                       | `MUL ECX`                                 |
| IMUL (multiplicación con signo) | La instrucción IMUL no solo es multiplicar con signo de la misma forma que lo hacia MUL<br>Es igual que antes ECX por EAX y el resultado se guarda en EDX:EAX salvo que se considera el signo de los operandos.<br>Además de la similitud con la instrucción anterior IMUL permite poner mas de un operando, lo que no estaba permitido en MUL. | `IMUL EBP, DWORD PTR [ESI+74], 0FF800002` |
| DIV (Unsigned Divide)           | DIV solo tiene un operando y no considera los signos y el resultado se guarda en EDX:EAX                                                                                                                                                                                                                                                        |                                           |
| IDIV (Signed Divide)            | IDIV siempre considera los signos si usa un solo operando será como DIV y guardara en EDX:EAX y en el caso de dos operandos dividirá ambos y guardara en el primero, y en el de tres operandos dividirá el segundo y el tercero y guardara en el primero.                                                                                       |                                           |
| XADD (Exchange and Add)         | Es como realizar en una sola instrucción XCHG y ADD.                                                                                                                                                                                                                                                                                            | `XADD EAX,ECX`                            |
| NEG                             | Esta instrucción tiene la finalidad de cambiar de signo el número representado o sea que si tenemos el número 32 en hexa y le aplicamos NEG el resultado será el negativo del mismo.                                                                                                                                                            | `NEG EAX`                                 |
# Instrucciones lógicas

| Commando | Descripción                                                                               | Ejemplo       |
| -------- | ----------------------------------------------------------------------------------------- | ------------- |
| AND      | El resultado es 1 si los dos bits son 1, y 0 en cualquier otro caso.                      | `AND ECX,EAX` |
| OR       | El resultado es 1 si uno o los dos operandos es 1, y 0 en cualquier otro caso.            |               |
| XOR      | El resultado es 1 si uno y sólo uno de los dos operandos es 1, y 0 en cualquier otro caso |               |
| NOT      | Simplemente invierte el valor del único operando de esta función                          |               |
# Comparaciones

| Commando               | Descripción                                                                                                                                                                                                                                                                                                                                                                                                          | Ejemplo        |
| ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| CMP                    | Compara dos operandos, en realidad es una instrucción SUB, que no guarda el resultado de la resta en el primer operando, ambos operandos quedan igual, lo que cambian son los flags según el resultado.                                                                                                                                                                                                              | `CMP EAX, ECX` |
| TEST (Logical Compare) | El principio de esta instrucción es, en cierto modo, el mismo de cmp, es decir, una operación entre dos valores que no se guarda, sino que puede modificar el estado de algunos flags (en este caso, SF, ZF y PF) que determinan si debe efectuarse el salto que también suele acompañar a esta instrucción. La diferencia está en que en este caso, en vez de tratarse de una resta, se trata de una operación AND. | `TEST EAX,EAX` |
# Saltos condicionales 

Todos as instrucciones de salto tienen un solo operando que es la dirección adonde saltaría el programa, veamos los diferentes tipos aquí en la tabla y aclarémoslos.

![](../Images/Pasted%20image%2020241011193255.png)

| Commando    | Descripción                                                                                                                                                                                                                                   |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| JMP         | Es el salto directo o incondicional, siempre salta a la dirección que nos muestra el operando                                                                                                                                                 |
| JE o JZ     | Salta cuando el flag Z sea cero.                                                                                                                                                                                                              |
| JNE o JNZ   | Salta si el flag Z no esta activo o sea si el resultado de la operación fue distinto de cero.                                                                                                                                                 |
| JS          | Salta si la comparación da un resultado negativo                                                                                                                                                                                              |
| JNS         | Salta cuando el FLAG S este a cero o sea cuando el resultado sea positivo.                                                                                                                                                                    |
| JP O JPE    | Salta cuando el FLAG P este activo y esto ocurrirá cuando el resultado de la comparación tenga paridad.                                                                                                                                       |
| JNP o  JNPE | Salta cuando el flag P esta a cero o sea la paridad es impar.                                                                                                                                                                                 |
| JO          | Salta cuando hay overflow o capacidad excedida lo cual activa el flag O.                                                                                                                                                                      |
| JNO         | salta cuando el FLAG O esta a CERO o sea no hay OVERFLOW.                                                                                                                                                                                     |
| JB          | Salta si es mas bajo.                                                                                                                                                                                                                         |
| JNB         | Saltara si el FLAG C es cero o sea no hay acarreo porque el resultado fue positivo, lo cual supone que EAX fue mayor que ECX y al revés que el anterior este saltara en ese  caso.                                                            |
| JBE         | Salta si es mas bajo o igual o sea testea dos flags a la vez ve si el FLAG C esta activo en ese caso salta, y también verifica si el FLAG Z esta activo con el cual también salta, o sea si EAX es igual a ECX saltara y si es menor también. |
| JNBE        | Salta si el flag Z y el FLAG C son cero ambos.                                                                                                                                                                                                |
| JL          | Salta si es menor, pero en diferente forma, veamos aquí mira si FLAG S es diferente a FLAG O y en ese caso salta.                                                                                                                             |
![](../Images/Pasted%20image%2020241012094113.png)
# Instrucciones CALL y RET

| Commando | Descripción                                                                                                                                                                                                                                                                                                                              | Ejemplo |
| -------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- |
| CALL     | Ejecuta una subrutina o si quieren parte del programa cuya dirección esta dada por el valor del operando.                                                                                                                                                                                                                                |         |
| RET      | Es el final de la rutina y contrapartida de la instrucción CALL, si CALL nos trajo aquí, RET nos devolverá a la zona donde estábamos antes de entrar en esta rutina. Pero además RET quitara la dirección de retorno del stack que es un valor que al sistema ya no le interesa pues ya volvemos y luego la dirección ya no es útil más. |         |

# Loops

| Commando       | Descripción                     | Ejemplo                                                                                        |
| -------------- | ------------------------------- | ---------------------------------------------------------------------------------------------- |
| Manual         |                                 | ``XOR ECX,ECX``<br>``ADD ECX,15 ``<br>``DEC  ECX``<br>``TEST ECX,ECX``<br>``JNZ SHORT 401007`` |
| LOOPD          |                                 | `LOOPD SHORT 401007`                                                                           |
| LOOPZ, LOOPE   | Realiza un blucle si es cero.   |                                                                                                |
| LOOPNZ, LOOPNE | Realiza un bucle si no es cero. |                                                                                                |

# Instrucciones para el manejo de cadenas e bytes

| Commando | Descripción                                                                                                                                                                                                                                                              | Ejemplo |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------- |
| MOVS     | Mueve el contenido de ESI al contenido de EDI, realmente no necesita ningún parámetro, pero al escribir en OLLY la instrucción MOVS y apretar ASSEMBLE, la completa (innecesariamente) al ensamblar y queda como: <br><br>``MOVS DWORD PTR ES:[EDI],DWORD PTR DS:[ESI]`` |         |
| REP      |                                                                                                                                                                                                                                                                          |         |
| COMPS    |                                                                                                                                                                                                                                                                          |         |


# Referencias

[Ricardo Narvaja](https://ricardonarvaja.info/)
